(function(b){var a=b.Event;function c(g,e){var f,d;f=e.parentNode;d=e.nextSibling;if(d){f.insertBefore(g,d)}else{f.appendChild(g)}return g}b.plugins.Paste=function(e){var h=b.DOM,f;e.onPaste=new b.Dispatcher(e);function g(s){var t,q=[],m,p,l=e.selection,k,n,o,j;e.getWin().focus();if(f){r=e.selection.getRng();r.moveToBookmark(f);r.select()}t=s.split(/\r?\n/);if(t.length>1){s="";b.each(t,function(i){s+="<p>"+i+"</p>"});if(!b.isIE){l.setContent('<span id="marker"></span>');m=e.dom.getParent(e.dom.get("marker").parentNode,function(i){q.push(i);if(/^(p|h[1-6]|div)$/i.test(i.nodeName)){return true}});if(m){e.onPaste.dispatch({text:s});k=n="";for(o=0;o<q.length;o++){k+="</"+q[o].nodeName.toLowerCase()+">"}for(o=q.length-1;o>=0;o--){n+="<"+q[o].nodeName.toLowerCase()+">"}s=k+s+n+'<span id="_caret">&nbsp;</span>';e.getBody().innerHTML=e.getBody().innerHTML.replace(/<span id=\"marker\"><\/span>/gi,s);p=e.dom.get("_caret");if(!b.isGecko){p.scrollIntoView()}j=e.getDoc().createRange();j.setStartBefore(p);j.setEndAfter(p);l.setRng(j);e.execCommand("Delete");return}}}e.selection.setContent(s);e.onPaste.dispatch({text:s})}function d(j){var l=c(h.create("textarea",{id:"punymce_paste",style:"position:absolute;width:1px;height:1px"}),h.get(e.settings.id+"_c")),i,k;l.focus();setTimeout(function(){k=l.value;l.parentNode.removeChild(l);g(k)},0)}e.onInit.add(function(){if(b.isOpera){return}if(/WebKit/.test(navigator.userAgent)||b.isIE){a.add(b.isIE?e.getBody():e.getDoc(),"paste",function(i){var j;if(e.getWin().clipboardData){j=e.getWin().clipboardData.getData("Text")}else{j=i.clipboardData.getData("text/plain")}g(j);return a.cancel(i)})}else{a.add(e.getDoc(),"keydown",function(i){if(((i.metaKey||i.ctrlKey)&&i.keyCode==86)||(i.shiftKey&&i.keyCode==45)){if(b.isIE){f=e.selection.getRng().getBookmark()}d(i)}},this)}})}})(punymce);